<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Supervision Recording Portal</title>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- Top header bar (serious, government-style layout without GOV.UK branding) -->
  <header class="app-header" role="banner">
    <div class="container app-header__inner">
      <div class="app-header__left">
        <span class="app-header__brand">Compliance Portal</span>
      </div>
      <div class="app-header__center">Supervision Recording</div>
      <div class="app-header__right">Worker- <strong>Archabahen Shaileshbhai Patel</strong></div>
    </div>
  </header>

  <main class="container" role="main">
    <!-- Phase banner -->
    <div class="phase-banner" aria-label="Service status">
      <strong class="phase-banner__tag">BETA</strong>
      <span class="phase-banner__text">This is an internal training/demo service.</span>
    </div>

    <!-- Service name banner -->
    <section class="service-name" aria-label="Service name">
      <div class="service-name__box">
        <strong class="service-name__text">Skilled Worker Supervision Recording</strong>
      </div>
    </section>

    <!-- Back link -->
    <p class="back-link-wrap">
      <a class="back-link" href="#" onclick="history.back(); return false;">Back</a>
    </p>

    <h1>Supervision session (recording optional).</h1>
    <h2 class="section-heading">This is a live session.</h2>

    <!-- Summary block -->
    <div class="summary" role="region" aria-label="Supervision summary">
      <div class="summary__row">
        <div class="summary__key">Worker</div>
        <div class="summary__value">Archabahen Shaileshbhai Patel - Skilled Worker</div>
      </div>

      <div class="summary__divider" role="presentation"></div>

      <div class="summary__row">
        <div class="summary__key">Session</div>
        <div class="summary__value">Health &amp; Care Worker Supervision. Target submission date: 28 February 2026.</div>
      </div>

      <div class="summary__divider" role="presentation"></div>

      <div class="summary__row summary__row--total">
        <div class="summary__key">Reminder</div>
        <div class="summary__value">
          Please check your microphone and camera settings. The camera feed should clearly show both the supervisor and the worker.
        </div>
      </div>
    </div>

    <!-- Warning box -->
    <div class="warning" role="note" aria-label="Before you continue">
      <div class="warning__icon" aria-hidden="true">!</div>
      <div class="warning__content">
        <h3 class="warning__title">Before you continue</h3>
        <p class="warning__text">
          This meeting is conducted for internal compliance, safeguarding and quality assurance purposes.
          We require full and proper responses from the worker. Short answers may require follow-up questions.
        </p>
        <p class="warning__text">
          Once you select ‘Submit supervision’ you may not be able to return and edit this session record.
        </p>
      </div>
    </div>

    <!-- LIVE Questions (one-by-one) -->
    <section class="qa" aria-label="Live supervision questions">
      <div class="qa__header">
        <h3 class="qa__title">Compliance supervision and welfare questions (live)</h3>
        <p class="qa__subtitle">
          Questions appear one at a time during the session. Answer clearly and provide examples where possible.
        </p>
      </div>

      <div class="qa__body">
        <div class="qa__meta" aria-live="polite">
          <span class="qa__count" id="qaCount">Question 1 of 10</span>
          <span class="qa__live" aria-hidden="true">LIVE</span>
        </div>

        <div class="qa__card" role="group" aria-label="Current question">
          <div class="qa__q" id="qaQuestion">Loading question…</div>
          <div class="qa__hint" id="qaHint"></div>
        </div>

        <div class="qa__controls" aria-label="Question navigation">
          <button type="button" class="qa-btn" id="qaPrev" aria-label="Previous question">Previous</button>
          <button type="button" class="qa-btn qa-btn--primary" id="qaNext" aria-label="Next question">Next question</button>
        </div>

        <div class="qa__progress" role="progressbar" aria-label="Question progress" aria-valuemin="1" aria-valuemax="10" aria-valuenow="1">
          <div class="qa__progress-bar" id="qaProgressBar" style="width: 10%;"></div>
        </div>
      </div>

      <div class="qa__footer" role="note">
        <strong>Tip:</strong> If you do not know an answer, say so and explain how you would find out.
      </div>
    </section>

    <p class="body-text">
      Continue to the secure portal to complete your staff supervision record. Access may be restricted depending on user permissions.
    </p>

    <div class="actions">
      <!-- Session recording notice -->
      <div class="recording-panel" role="note" aria-label="Session recording notice">
        <div class="recording-panel__badge">
          <span class="recording-badge" aria-hidden="true">SESSION</span>
          <span class="recording-panel__title">Session recording control</span>
        </div>
        <p class="recording-panel__text">
          Recording does not begin automatically. Select “Start recording” when ready.
        </p>
      </div>

      <!-- Recording controls -->
      <div class="recording-controls" aria-label="Recording controls">
        <button
          type="button"
          id="recToggle"
          class="rec-toggle rec-toggle--off"
          aria-pressed="false"
          aria-label="Start recording"
        >
          <span class="rec-dot" aria-hidden="true">
            <!-- Mic icon (inline SVG) -->
            <svg class="rec-mic" viewBox="0 0 24 24" role="img" aria-label="Microphone icon">
              <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3Zm5-3a1 1 0 1 0-2 0 3 3 0 0 1-6 0 1 1 0 1 0-2 0 5 5 0 0 0 4 4.9V18H9a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-2v-2.1A5 5 0 0 0 17 11Z"/>
            </svg>
          </span>
          <span class="rec-toggle__text" id="recToggleText">Start recording</span>
        </button>

        <div class="rec-status" aria-live="polite">
          <span class="rec-status__label" id="recStatusLabel">Not recording</span>
          <span class="rec-status__sep" aria-hidden="true">•</span>
          <span class="rec-timer" id="recTimer">00:00</span>
        </div>
      </div>

      <!-- Consent -->
      <div class="consent" role="group" aria-label="Consent">
        <label class="consent__label">
          <input type="checkbox" id="consentCheck" class="consent__checkbox" />
          <span class="consent__text">
            I confirm I have informed all participants that this session may be recorded for internal compliance, safeguarding and quality purposes,
            and I have the required permission to proceed.
          </span>
        </label>
        <p class="consent__hint" id="consentHint">
          You must confirm consent before you can submit the supervision record.
        </p>
      </div>

      <!-- Submit button (disabled until consent is ticked) -->
      <a
        class="button button--disabled"
        id="submitBtn"
        href="https://www.gov.uk/government/publications/workers-and-temporary-workers-guidance-for-sponsors-part-2-sponsor-a-worker/workers-and-temporary-workers-guidance-for-sponsors-part-2-sponsor-a-worker-general-information-accessible"
        target="_blank"
        rel="noopener noreferrer"
        aria-disabled="true"
      >
        Submit supervision
      </a>
    </div>

    <ul class="link-list">
      <li><a href="#">Return to this application later</a></li>
      <li><a href="#">Show and edit answers</a></li>
    </ul>
  </main>

  <!-- Footer -->
  <footer class="app-footer" role="contentinfo">
    <div class="container app-footer__inner">
      <div class="app-footer__links">
        <a href="#">Cookies</a>
        <a href="#">Terms and Conditions</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Accessibility</a>
        <a href="#">Contact</a>
      </div>

      <div class="app-footer__meta">
        <p class="app-footer__note">
          Internal training/demo interface. Do not present this page as an official government service.
        </p>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      // ---------------------------
      // Recording UI (starts OFF)
      // ---------------------------
      const btn = document.getElementById("recToggle");
      const btnText = document.getElementById("recToggleText");
      const statusLabel = document.getElementById("recStatusLabel");
      const timerEl = document.getElementById("recTimer");

      let isRecording = false;
      let startTime = 0;
      let elapsedMs = 0;
      let intervalId = null;

      function pad2(n) {
        return String(n).padStart(2, "0");
      }

      function formatTime(ms) {
        const totalSec = Math.floor(ms / 1000);
        const mm = Math.floor(totalSec / 60);
        const ss = totalSec % 60;
        return pad2(mm) + ":" + pad2(ss);
      }

      function renderTimer() {
        timerEl.textContent = formatTime(elapsedMs);
      }

      function tick() {
        elapsedMs = Date.now() - startTime;
        renderTimer();
      }

      function startRec() {
        isRecording = true;
        btn.classList.remove("rec-toggle--off");
        btn.setAttribute("aria-pressed", "true");
        btn.setAttribute("aria-label", "Stop recording");
        btnText.textContent = "Stop recording";
        statusLabel.textContent = "Recording";

        startTime = Date.now() - elapsedMs;
        if (!intervalId) intervalId = setInterval(tick, 250);
      }

      function stopRec() {
        isRecording = false;
        btn.classList.add("rec-toggle--off");
        btn.setAttribute("aria-pressed", "false");
        btn.setAttribute("aria-label", "Start recording");
        btnText.textContent = "Start recording";
        statusLabel.textContent = "Not recording";

        if (intervalId) clearInterval(intervalId);
        intervalId = null;
        renderTimer();
      }

      btn.addEventListener("click", function () {
        if (isRecording) stopRec();
        else startRec();
      });

      renderTimer(); // initial paint
      stopRec();     // enforce off state


      // ---------------------------
      // Consent gating (enables submit)
      // ---------------------------
      const consentCheck = document.getElementById("consentCheck");
      const submitBtn = document.getElementById("submitBtn");
      const consentHint = document.getElementById("consentHint");

      function setSubmitEnabled(enabled) {
        if (enabled) {
          submitBtn.classList.remove("button--disabled");
          submitBtn.setAttribute("aria-disabled", "false");
          consentHint.textContent = "Consent confirmed. You can now submit.";
        } else {
          submitBtn.classList.add("button--disabled");
          submitBtn.setAttribute("aria-disabled", "true");
          consentHint.textContent = "You must confirm consent before you can submit the supervision record.";
        }
      }

      consentCheck.addEventListener("change", function () {
        setSubmitEnabled(consentCheck.checked);
      });

      // Prevent click when disabled (anchor can't truly disable)
      submitBtn.addEventListener("click", function (e) {
        if (submitBtn.getAttribute("aria-disabled") === "true") {
          e.preventDefault();
          consentHint.focus?.();
        }
      });

      setSubmitEnabled(false);


      // ---------------------------
      // LIVE Questions (one-by-one)
      // ---------------------------
      const questions = [
        {
          q: "Confirm your job title and main duties in your own words.",
          hint: "Include typical tasks you do each week."
        },
        {
          q: "Who is your line manager and how often do you receive supervision?",
          hint: "State the last supervision date if you can."
        },
        {
          q: "What are your normal working hours and where do you usually work from?",
          hint: "Include any regular changes (e.g., rota patterns)."
        },
        {
          q: "Explain your current rota: how is it issued and how do you confirm shifts?",
          hint: "Mention the system/app used (if any)."
        },
        {
          q: "Describe how you record visit notes and report incidents or safeguarding concerns.",
          hint: "Give one example of a situation and what you did."
        },
        {
          q: "What training have you completed in the last 3 months?",
          hint: "E.g., moving & handling, medication, safeguarding, infection control."
        },
        {
          q: "If you were unsure about a care task, what steps would you take before proceeding?",
          hint: "Focus on escalation and safe practice."
        },
        {
          q: "Do you have any health, wellbeing, or workload concerns you want to raise today?",
          hint: "This can include stress, fatigue, or support needs."
        },
        {
          q: "Confirm you understand your obligation to notify your employer about changes to contact details or availability.",
          hint: "Explain what you would do if your circumstances change."
        },
        {
          q: "Is there anything preventing you from meeting the required standard of communication in your role?",
          hint: "If yes, describe what support would help."
        }
      ];

      const qaCount = document.getElementById("qaCount");
      const qaQuestion = document.getElementById("qaQuestion");
      const qaHint = document.getElementById("qaHint");
      const qaPrev = document.getElementById("qaPrev");
      const qaNext = document.getElementById("qaNext");
      const qaProgressBar = document.getElementById("qaProgressBar");
      const qaProgress = document.querySelector(".qa__progress");

      let idx = 0;

      function renderQuestion() {
        const total = questions.length;
        const current = idx + 1;

        qaCount.textContent = `Question ${current} of ${total}`;
        qaQuestion.textContent = questions[idx].q;
        qaHint.textContent = questions[idx].hint || "";

        // Buttons
        qaPrev.disabled = idx === 0;
        qaPrev.classList.toggle("qa-btn--disabled", idx === 0);

        const isLast = idx === total - 1;
        qaNext.textContent = isLast ? "Finish" : "Next question";
        qaNext.setAttribute("aria-label", isLast ? "Finish questions" : "Next question");

        // Progressbar
        const pct = Math.round((current / total) * 100);
        qaProgressBar.style.width = pct + "%";
        qaProgress.setAttribute("aria-valuemin", "1");
        qaProgress.setAttribute("aria-valuemax", String(total));
        qaProgress.setAttribute("aria-valuenow", String(current));
      }

      qaPrev.addEventListener("click", function () {
        if (idx > 0) {
          idx--;
          renderQuestion();
        }
      });

      qaNext.addEventListener("click", function () {
        if (idx < questions.length - 1) {
          idx++;
          renderQuestion();
        } else {
          // Finish state
          qaQuestion.textContent = "Questions completed.";
          qaHint.textContent = "You may review responses and proceed when ready.";
          qaCount.textContent = `Completed (${questions.length} questions)`;
          qaPrev.disabled = false;
          qaPrev.classList.remove("qa-btn--disabled");
          qaNext.disabled = true;
          qaNext.classList.add("qa-btn--disabled");
          qaNext.textContent = "Finished";
          qaProgressBar.style.width = "100%";
          qaProgress.setAttribute("aria-valuenow", String(questions.length));
        }
      });

      renderQuestion();
    })();
  </script>
</body>
</html>
