<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Supervision Recording Portal</title>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="app-header" role="banner">
    <div class="container app-header__inner">
      <div class="app-header__left">
        <span class="app-header__brand">GOV.UK Compliance Portal</span>
      </div>
      <div class="app-header__center">Supervision Recording</div>
      <div class="app-header__right">Worker- <strong>Archabahen Shaileshbhai Patel</strong></div>
    </div>
  </header>

  <main class="container" role="main">
    <div class="phase-banner" aria-label="Service status">
      <strong class="phase-banner__tag">BETA</strong>
      <span class="phase-banner__text">This is a new service.</span>
    </div>

    <section class="service-name" aria-label="Service name">
      <div class="service-name__box">
        <strong class="service-name__text">Skilled Worker Supervision Recording</strong>
      </div>
    </section>

    <p class="back-link-wrap">
      <a class="back-link" href="#" onclick="history.back(); return false;">Back</a>
    </p>

    <h1>Supervision session.</h1>
    <h2 class="section-heading">This is a live session.</h2>

    <div class="summary" role="region" aria-label="Supervision summary">
      <div class="summary__row">
        <div class="summary__key">Worker</div>
        <div class="summary__value">Archabahen Shaileshbhai Patel - Skilled Worker</div>
      </div>

      <div class="summary__divider" role="presentation"></div>

      <div class="summary__row">
        <div class="summary__key">Session</div>
        <div class="summary__value">Health &amp; Care Worker Supervision. Target submission date: 28 February 2026.</div>
      </div>

      <div class="summary__divider" role="presentation"></div>

      <div class="summary__row summary__row--total">
        <div class="summary__key">Reminder</div>
        <div class="summary__value">
          Please check your microphone and camera settings. The camera feed should clearly show both the supervisor and the worker.
        </div>
      </div>
    </div>

    <div class="warning" role="note" aria-label="Before you continue">
      <div class="warning__icon" aria-hidden="true">!</div>
      <div class="warning__content">
        <h3 class="warning__title">Before you continue</h3>
        <p class="warning__text">
          This meeting is conducted for internal compliance, safeguarding and quality assurance purposes.
          We require full and proper responses from the worker. Short answers may require follow-up questions. Questions are randomly generated.
        </p>
        <p class="warning__text">
          Once you select ‘Submit supervision’ you may not be able to return and edit this session record.
        </p>
      </div>
    </div>

    <!-- LIVE Questions (hidden until recording starts) -->
    <section class="qa" aria-label="Live supervision questions">
      <div class="qa__header">
        <h3 class="qa__title">Compliance supervision and welfare questions (live)</h3>
        <p class="qa__subtitle">
          Questions appear one at a time during the session. Answer clearly and provide examples where possible.
          The person conducting this meeting should ask the questions verbally.
        </p>
      </div>

      <div class="qa__body">
        <div class="qa__meta" aria-live="polite">
          <div class="qa__metaRow">
            <span class="qa__liveTitle" id="qaLiveTitle">Questions (UKVI Prerequisite LIVE)</span>

            <span class="qa__liveBadge" id="qaLiveBadge" aria-label="Live">
              <span class="qa__liveDot" aria-hidden="true"></span>
              LIVE
            </span>
          </div>

          <div class="qa__metaRow qa__metaRow--secondary">
            <span class="qa__number" id="qaNumber">Questions will appear after recording has started.</span>
          </div>
        </div>

        <div class="qa__card qa__card--hidden" id="qaCard" role="group" aria-label="Current question">
          <div class="qa__q" id="qaQuestion"></div>
          <div class="qa__hint" id="qaHint"></div>
        </div>

        <div class="qa__controls" aria-label="Question navigation">
          <button
            type="button"
            class="qa-btn"
            id="qaNext"
            aria-label="Next question"
            disabled
          >
            Next question
          </button>
        </div>

        <div class="qa__progress" role="progressbar" aria-label="Question progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="qa__progress-bar" id="qaProgressBar" style="width: 0%;"></div>
        </div>

        <p class="qa__lockNote" id="qaLockNote">
          You must start recording before questions are shown.
        </p>
      </div>

      <div class="qa__footer" role="note">
        <strong>Tip:</strong> If you do not know an answer, say so and explain how you would find out.
      </div>
    </section>

    <p class="body-text body-text--subtle">
      This recording will be shared with UKVI and the Care Quality Commission CQC.
    </p>

    <div class="actions">
      <div class="recording-panel" role="note" aria-label="Session recording notice">
        <div class="recording-panel__badge">
          <span class="recording-badge" aria-hidden="true">SESSION</span>
          <span class="recording-panel__title">Session recording control</span>
        </div>
        <p class="recording-panel__text">
          Recording does not begin automatically. Select “Start recording” when ready.
        </p>
      </div>

      <div class="recording-controls" aria-label="Recording controls">
        <button
          type="button"
          id="recToggle"
          class="rec-toggle rec-toggle--off"
          aria-pressed="false"
          aria-label="Start recording"
        >
          <span class="rec-dot" aria-hidden="true">
            <svg class="rec-mic" viewBox="0 0 24 24" role="img" aria-label="Microphone icon">
              <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3Zm5-3a1 1 0 1 0-2 0 3 3 0 0 1-6 0 1 1 0 1 0-2 0 5 5 0 0 0 4 4.9V18H9a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-2v-2.1A5 5 0 0 0 17 11Z"/>
            </svg>
          </span>
          <span class="rec-toggle__text" id="recToggleText">Start recording</span>
        </button>

        <div class="rec-status" aria-live="polite">
          <span class="rec-status__label" id="recStatusLabel">Not recording</span>
          <span class="rec-status__sep" aria-hidden="true">•</span>
          <span class="rec-timer" id="recTimer">00:00</span>
        </div>
      </div>

      <div class="consent" role="group" aria-label="Consent">
        <label class="consent__label">
          <input type="checkbox" id="consentCheck" class="consent__checkbox" />
          <span class="consent__text">
            I confirm I have informed all participants that this session may be recorded for internal compliance, safeguarding and quality purposes,
            and I have the required permission to proceed.
          </span>
        </label>
        <p class="consent__hint" id="consentHint">
          You must confirm consent and start recording before you can submit.
        </p>
      </div>

      <a class="button button--disabled" id="submitBtn" href="#" aria-disabled="true">
        Submit supervision
      </a>
    </div>

    <ul class="link-list">
      <li><a href="#">Return to this application later</a></li>
      <li><a href="#">Show and edit answers</a></li>
    </ul>
  </main>

  <!-- Floating webcam preview (outside questions card) -->
  <aside class="cam-float" aria-label="Camera preview">
    <div class="cam__header">
      <span class="cam__title">UKVI Camera Feed</span>
      <span class="cam__status" id="camStatus">Off</span>
    </div>

    <div class="cam__frame">
      <video id="camVideo" autoplay playsinline muted></video>
    </div>

    <p class="cam__note">Live recording. Camera access requires permission.</p>
  </aside>

  <footer class="app-footer" role="contentinfo">
    <div class="container app-footer__inner">
      <div class="app-footer__links">
        <a href="#">Cookies</a>
        <a href="#">Terms and Conditions</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Accessibility</a>
        <a href="#">Contact</a>
      </div>

      <div class="app-footer__meta">
        <p class="app-footer__note">
          All content is available under the Open Government Licence v3.0, except where otherwise stated.
        </p>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      const btn = document.getElementById("recToggle");
      const btnText = document.getElementById("recToggleText");
      const statusLabel = document.getElementById("recStatusLabel");
      const timerEl = document.getElementById("recTimer");

      const consentCheck = document.getElementById("consentCheck");
      const submitBtn = document.getElementById("submitBtn");
      const consentHint = document.getElementById("consentHint");

      const qaNumber = document.getElementById("qaNumber");
      const qaQuestion = document.getElementById("qaQuestion");
      const qaHint = document.getElementById("qaHint");
      const qaNext = document.getElementById("qaNext");
      const qaProgressBar = document.getElementById("qaProgressBar");
      const qaProgress = document.querySelector(".qa__progress");
      const qaLockNote = document.getElementById("qaLockNote");
      const qaCard = document.getElementById("qaCard");
      const qaLiveBadge = document.getElementById("qaLiveBadge");

      // Webcam
      const camVideo = document.getElementById("camVideo");
      const camStatus = document.getElementById("camStatus");
      let camStream = null;

      let isRecording = false;
      let startTime = 0;
      let elapsedMs = 0;
      let intervalId = null;

      function pad2(n) { return String(n).padStart(2, "0"); }
      function formatTime(ms) {
        const totalSec = Math.floor(ms / 1000);
        const mm = Math.floor(totalSec / 60);
        const ss = totalSec % 60;
        return pad2(mm) + ":" + pad2(ss);
      }
      function renderTimer() { timerEl.textContent = formatTime(elapsedMs); }

      async function startCamera() {
        if (camStream) return;
        try {
          camStream = await navigator.mediaDevices.getUserMedia({
            video: { width: 640, height: 480, facingMode: "user" },
            audio: false
          });
          camVideo.srcObject = camStream;
          camStatus.textContent = "On";
          camStatus.classList.add("cam__status--on");
        } catch (err) {
          camStatus.textContent = "Blocked";
          camStatus.classList.remove("cam__status--on");
          console.error("Camera error:", err);
        }
      }

      function stopCamera() {
        if (!camStream) {
          camVideo.srcObject = null;
          camStatus.textContent = "Off";
          camStatus.classList.remove("cam__status--on");
          return;
        }
        camStream.getTracks().forEach(t => t.stop());
        camStream = null;
        camVideo.srcObject = null;
        camStatus.textContent = "Off";
        camStatus.classList.remove("cam__status--on");
      }

      function updateSubmitState() {
        const ok = consentCheck.checked && isRecording;
        if (ok) {
          submitBtn.classList.remove("button--disabled");
          submitBtn.setAttribute("aria-disabled", "false");
          consentHint.textContent = "Consent confirmed and recording started. You can now submit.";
        } else {
          submitBtn.classList.add("button--disabled");
          submitBtn.setAttribute("aria-disabled", "true");

          if (!consentCheck.checked && !isRecording) {
            consentHint.textContent = "You must confirm consent and start recording before you can submit.";
          } else if (!consentCheck.checked) {
            consentHint.textContent = "You must confirm consent before you can submit.";
          } else {
            consentHint.textContent = "You must start recording before you can submit.";
          }
        }
      }

      function setQuestionsVisible(visible) {
        if (visible) {
          qaCard.classList.remove("qa__card--hidden");
          qaNext.disabled = false;
          qaLockNote.style.display = "none";
          qaLiveBadge.style.display = "inline-flex";
        } else {
          qaCard.classList.add("qa__card--hidden");
          qaNext.disabled = true;
          qaLockNote.style.display = "block";
          qaLiveBadge.style.display = "none";

          qaNumber.textContent = "Questions will appear after recording has started.";
          qaQuestion.textContent = "";
          qaHint.textContent = "";

          qaProgressBar.style.width = "0%";
          qaProgress.setAttribute("aria-valuenow", "0");
        }
      }

      function tick() {
        elapsedMs = Date.now() - startTime;
        renderTimer();
      }

      function startRec() {
        isRecording = true;
        btn.classList.remove("rec-toggle--off");
        btn.setAttribute("aria-pressed", "true");
        btn.setAttribute("aria-label", "Stop recording");
        btnText.textContent = "Stop recording";
        statusLabel.textContent = "Recording";

        startTime = Date.now() - elapsedMs;
        if (!intervalId) intervalId = setInterval(tick, 250);

        startCamera();

        idx = 0;
        renderQuestion();
        setQuestionsVisible(true);

        updateSubmitState();
      }

      function stopRec() {
        isRecording = false;
        btn.classList.add("rec-toggle--off");
        btn.setAttribute("aria-pressed", "false");
        btn.setAttribute("aria-label", "Start recording");
        btnText.textContent = "Start recording";
        statusLabel.textContent = "Not recording";

        if (intervalId) clearInterval(intervalId);
        intervalId = null;
        renderTimer();

        stopCamera();
        setQuestionsVisible(false);
        updateSubmitState();
      }

      btn.addEventListener("click", function () {
        if (isRecording) stopRec();
        else startRec();
      });

      submitBtn.addEventListener("click", function (e) {
        if (submitBtn.getAttribute("aria-disabled") === "true") e.preventDefault();
      });

      consentCheck.addEventListener("change", updateSubmitState);

      renderTimer();
      stopRec();
      setQuestionsVisible(false);
      updateSubmitState();

      const questions = [
        { q: "State your name and address.", hint: "Say your full name and address." },
        { q: "Confirm your job title and main duties in your own words.", hint: "Include typical tasks you do each week." },
        { q: "Do your tasks align with your duty description?", hint: "Explain in your own words." },
        { q: "Who is your line manager and how often do you receive supervision?", hint: "State the last supervision date if you can." },
        { q: "How do you receive your rota and how do you confirm shifts?", hint: "Mention the method or system used." },
        { q: "What are your normal working hours and where do you usually work from?", hint: "Include rota patterns and locations." },
        { q: "Are you aware of the restrictions imposed on your working hours?", hint: "" },
        { q: "Are you working anywhere else?", hint: "Answer clearly." },
        { q: "Have you worked on any other projects other than with the sponsored company?", hint: "" },
        { q: "Was it made clear to you that working for any other firm will require written consent from the current employer?", hint: "" },
        { q: "What is the current rate at which you are being paid?", hint: "State hourly rate/salary and how often you are paid." },
        { q: "Do you receive payslips and can you confirm how you are paid?", hint: "E.g., bank transfer; frequency; payslip access." },
        { q: "Are you being responsible in paying your taxes?", hint: "Answer truthfully." },
        { q: "Are you aware that working cash in hand is considered an illegal activity in the UK?", hint: "" },
        { q: "How many years experience do you have working in Health Care?", hint: "" },
        { q: "In your opinion, what is the biggest obstacle you are facing at work right now?", hint: "" },
        { q: "Are you comfortable working for the sponsored company?", hint: "" },
        { q: "What tasks or activities do you feel confident doing in your current role?", hint: "" },
        { q: "Are you aware of the concept of modern slavery?", hint: "exploitation or commercial gain" },
        { q: "Do you believe you are being exploited by the sponsored company?", hint: "If yes, explain why." },
        { q: "Do you believe the employer has been treating yourself and other staff members fairly?", hint: "You don't need to take any names of colleagues" },
        { q: "How do you get on with your co-workers?", hint: "You don't need to take any names" },
        { q: "Have you ever had any complaints regarding anybody at your workplace?", hint: "If yes, describe what happened." },
        { q: "Have you been coached prior to this supervision?", hint: "If yes, explain by whom." },
        { q: "What do you understand by Safeguarding", hint: "Explain in detail." },
        { q: "Why is supervision important?", hint: "Explain in detail." },
        { q: "Describe how you record visit notes and report incidents or safeguarding concerns.", hint: "Give one example of what you would do." },
        { q: "What training have you completed in the last 3 months?", hint: "E.g., safeguarding, medication, infection control." },
        { q: "If you were unsure about a care task, what steps would you take before proceeding?", hint: "Focus on escalation and safe practice." },
        { q: "Have you passed a B2 English test?", hint: "If not, state when this will take place." },
        { q: "Do you have any health, wellbeing, or workload concerns you want to raise today?", hint: "This can include stress or support needs." }
      ];

      let idx = 0;

      function renderQuestion() {
        const current = idx + 1;
        const total = questions.length;

        qaNumber.textContent = "Question " + current;
        qaQuestion.textContent = questions[idx].q;
        qaHint.textContent = questions[idx].hint || "";

        const pct = Math.round((current / total) * 100);
        qaProgressBar.style.width = pct + "%";
        qaProgress.setAttribute("aria-valuenow", String(pct));

        const isLast = idx === total - 1;
        qaNext.textContent = isLast ? "Finish questions" : "Next question";
        qaNext.setAttribute("aria-label", isLast ? "Finish questions" : "Next question");
      }

      qaNext.addEventListener("click", function () {
        if (!isRecording) return;

        if (idx < questions.length - 1) {
          idx++;
          renderQuestion();
        } else {
          qaNumber.textContent = "Completed";
          qaQuestion.textContent = "Questions completed. You may proceed with your company standard supervision during this recorded session.";
          qaHint.textContent = "";
          qaNext.disabled = true;
          qaNext.textContent = "Finished";
          qaProgressBar.style.width = "100%";
          qaProgress.setAttribute("aria-valuenow", "100");
        }
      });

      window.addEventListener("beforeunload", stopCamera);
    })();
  </script>
</body>
</html>
